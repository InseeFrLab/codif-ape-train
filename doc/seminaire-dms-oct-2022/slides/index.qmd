---
title: Codification automatique de l’APE dans le cadre du projet Sirene 4 
subtitle: |
  **[Séminaire DMS]{.orange}**
author: |
  Thomas Faria,
  Tom Seimandi
date: 7 octobre 2022
slide-number: true
# uncomment for French presentations:
# lang: fr-FR
# for blind readers:
slide-tone: false
chalkboard: # press the B key to toggle chalkboard
  theme: whiteboard
# uncomment to use the multiplex mode:
# multiplex: true
format:
  onyxia-revealjs:
    output-file: index.html
controls: true
css: custom.css
from: markdown+emoji
---

# Introduction

## Contexte 


- [**Plusieurs changements majeurs**]{.blue2}: 
  - [**Interne**]{.green2} : Refonte du répertoire [**Sirene 4**]{.orange} ;
  - [**Externe**]{.green2} : Mise en place d'un [**guichet unique**]{.orange}.

- [**Constat**]{.blue2} : [**Sicore**]{.orange} n'est plus l'outil adapté &rarr; 30% de codification automatique.

- [**Conséquence**]{.blue2} : moment idéal pour proposer une nouvelle méthodologie de codification automatique de l'APE.

## Données

- [$\approx 10$ **millions**]{.orange} de liasses d'entreprises issues de Sirene 3 couvrant la période 2014-2022.
- [**Données labellisées**]{.orange} par Sicore ou par un gestionnaire.
- Une observation consiste en : 
  - un [**descriptif textuel**]{.red2} de l'activité
  - la [**nature de l’activité**]{.blue2} -- [NAT]{.green2} (23 modalités)
  - le [**type de la liasse**]{.blue2} -- [TYP]{.green2} (15 modalités)
  - le [**type d’évènement**]{.blue2} -- [EVT]{.green2} (24 modalités)
  - la [**surface ($m^2$)**]{.blue2}-- [SUR]{.green2} (4 modalités)

## La nomenclature hiérarchique de l'APE

| Niveau | Code | Libellé | Taille |
|-------|------|----------------------|-|
| Section     | H     |Transports et entreposage|21|
| Division    | 52    |Entreposage et services auxiliaires des transports|88|
| Groupe      | 522   |Services auxiliaires des transports|272|
| Classe      | 5224  |Manutention|615|
| **Sous-classe** | [**5224A**]{.red2} |**Manutention portuaire**|[**732**]{.orange}|

# Méthodologie {auto-animate=true}

## Utilisation de n-grams {auto-animate=true}

:::{.incremental}
- Plongements de mots : [**vectorisation**]{.orange}
- Plongements [**pré-entraînés**]{.orange} disponibles en open-source ;
- On apprend [**nos propres plongements**]{.orange} de mots ;
- On apprend aussi des plongements pour :
  - Les [**n-grams de mots**]{.orange} ;
  - Les [**n-grams de caractères**]{.orange} ;
:::

## Classifieur linéaire {auto-animate=true}

- [**2 méthodes**]{.orange} pour l'optimisation du classifieur : 
  - [**Softmax standard**]{.blue2} : un [**unique**]{.green2} classifieur multiclasse
  - [**One-vs-all**]{.blue2} : de [**multiples**]{.green2} classifieurs binaires
- [**Optimisation**]{.orange} : algorithme de type [**descente de gradient stochastique**]{.green2} ;
- [**Fonction de perte**]{.orange} : [**entropie croisée**]{.green2} ;

## Classification à partir de plongements lexicaux {auto-animate=true}

![](img/fastText_desc_ape.png){height="400" fig-align="center"}

## Implémentation, entraînement {auto-animate=true}

::: {layout-ncol=2}
![](img/fasttext.png){height="100"}

![](img/mlflow.png){height="100"}
:::

:::{.incremental}
- `fastText` : pas de prise en charge des variables catégorielles : concaténation avec le libellé ;
- Optimisation des paramètres d'entraînement et hyperparamètres avec `mlflow`.
:::
## Prise en compte de variables catégorielles

- [**Concaténation**]{.orange} du libellé ainsi que les noms et valeurs des variables annexes :

Libellé | NAT | TYP | EVT | SUR | 
--------|-----|-----|-----|-----|
Cours de musique | NaN | X | 01P |NaN

<center>
&#129155;
</center>

"Cours de musique [NAT]{.green2}\_[NaN]{.blue2} [TYP]{.green2}\_[X]{.blue2} [EVT]{.green2}\_[01P]{.blue2} [SUR]{.green2}\_[NaN]{.blue2}"

- [**Méthode imparfaite**]{.orange} : jetons "AT_" ou "T_0" utilisés

## Prétraitements effectués

-  [**Nettoyage**]{.orange} indispensable pour l'analyse textuelle 
- [**Contrainte**]{.orange} : [**simple**]{.blue2}, [**léger**]{.blue2} et facilement [**reproductible**]{.blue2} en Java


Transformation | Libellé |
--|-------------|
Entrée | 3 D : La Deratisation - La Desinsectisation - La Desinfection |
Passage en minuscule | 3 d : la deratisation - la desinsectisation - la desinfection |
Suppression des ponctuations | 3 d la deratisation la desinsectisation la desinfection |
Suppression des chiffres | d la deratisation la desinsectisation la desinfection |

## Prétraitements effectués

Transformation | Libellé |
--|-------------|
Entrée | 3 D : La Deratisation - La Desinsectisation - La Desinfection |
... | ... |
Suppression des mots à 1 lettre | la deratisation la desinsectisation la desinfection |
Suppression des stopwords | deratisation desinsectisation desinfection |
Suppression des NaN | deratisation desinsectisation desinfection |
Racinisation des mots | deratis desinsectis desinfect |



## Evaluation de la performance {auto-animate=true}

- Evaluation sur [**2 jeux de données**]{.orange} :
  - un jeu de [**test**]{.blue2}, 20\% des données soit [$\approx$ **2.5 millions**]{.green2} observations
  - un jeu issue du [**guichet unique**]{.blue2} [$\approx$ **15 000**]{.green2} observations

<center>
GRAPHIQUE DISTRIBUTION DES 2 JEUX DE DONNEES
</center>


## Evaluation de la performance {auto-animate=true}

- [**4 métriques**]{.orange} pour l'analyse de la performance : 
  - Le [**taux de précision**]{.blue2} : taux global de liasses bien prédites (*accuracy*) ;
  - Le [**rappel**]{.blue2} : taux de bonnes prédictions de la classe K parmi les vraies valeurs K ;
  - La [**précision**]{.blue2} : taux de bonnes prédictions de la classe K parmi les prédictions K ;
  - Le [**score F1**]{.blue2} : Moyenne harmonique du rappel et de la précision.


# Résultats obtenus

## De bons résultats

## Indice de confiance 

## Résultats hétérogènes

# Mise en production {auto-animate=true}

## Les enjeux {auto-animate=true}

:::{.incremental}
- Intégration dans [**Sirene 4**]{.orange} pour coder le guichet unique;
- Module de codification : API construite sur `JFastText` :arrow_right: pré-traitements ?
- Place et utilisation du module dans le SI Sirene 4;
- Définition du contenu des [**logs**]{.orange}.
:::

## Organisation {auto-animate=true}

![](img/orga_ape.png)

## Maintenance, réentraînement {auto-animate=true}

:::{.incremental}
- [**Monitoring du modèle**]{.orange} en production : quoi et à quelle fréquence ?
- [**Monitoring des liasses**]{.orange} à coder ?
- [**Réentraînement**]{.orange} d'un modèle : comment et à quelle fréquence ?
- Utilisation et maintenance des différents modules ?
- Gestion du [**changement de la NAF**]{.orange} ?
:::